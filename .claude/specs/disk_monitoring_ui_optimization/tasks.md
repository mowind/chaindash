# 磁盘监控UI优化实施计划

## 概述
本实施计划将把系统监控UI从垂直堆叠布局改为左右分屏布局。左侧显示系统监控，右侧显示磁盘挂载详情。计划分为6个主要任务，每个任务都建立在之前任务的基础上。

## 实施任务

### 1. 创建新的widget组件文件
- [ ] **目标**：创建SystemSummaryWidget和DiskListWidget组件文件
- [ ] 在`src/widgets/`目录下创建`system_summary.rs`文件
  - 参考`system.rs`中的`render_summary_only`方法
  - 只包含系统监控渲染逻辑（CPU、内存、网络）
  - 实现`Widget` trait和`UpdatableWidget` trait
- [ ] 在`src/widgets/`目录下创建`disk_list.rs`文件
  - 参考`system.rs`中的`render_disk_details`方法
  - 包含磁盘列表渲染逻辑
  - 支持多行显示所有磁盘挂载点
  - 实现`Widget` trait和`UpdatableWidget` trait
- [ ] 更新`src/widgets/mod.rs`文件
  - 导出新的widget组件
  - 保持现有导出不变
- **引用需求**：2.1, 2.2, 2.3, 2.4, 3.1, 3.2

### 2. 重构SystemWidget为适配器组件
- [ ] **目标**：修改现有SystemWidget作为向后兼容的适配器
- [ ] 修改`src/widgets/system.rs`文件
  - 移除`render_with_disk_details`方法
  - 修改`render`方法只调用`render_summary_only`
  - 添加注释说明这是向后兼容的适配器
  - 保持所有现有接口不变
- [ ] 测试SystemWidget仍然正常工作
  - 运行应用验证系统监控显示正常
  - 确保不显示磁盘详情（这是预期的临时状态）
- **引用需求**：5.1, 5.2, 5.3, 5.4

### 3. 修改布局逻辑实现左右分屏
- [ ] **目标**：在draw.rs中实现左右分屏布局
- [ ] 修改`src/draw.rs`文件中的`draw_system_row`函数
  - 将当前的水平布局（100%宽度）改为左右分屏布局
  - 左侧50%：渲染SystemSummaryWidget
  - 右侧50%：渲染DiskListWidget
  - 添加清晰的分隔线或边框
- [ ] 修改`src/draw.rs`文件中的Unix系统布局
  - 保持现有的垂直三部分布局不变
  - 只在顶部区域（20%）内部分屏
- [ ] 修改`src/draw.rs`文件中的非Unix系统布局
  - 在顶部区域（30%）内部分屏
  - 保持其他布局不变
- [ ] 更新`src/draw.rs`中的widget引用
  - 导入新的widget组件
  - 更新`draw_system_row`函数参数
- **引用需求**：1.1, 1.2, 1.3, 1.4, 4.1, 4.2, 4.3, 4.4

### 4. 实现DiskListWidget的多行磁盘列表
- [ ] **目标**：在DiskListWidget中实现完整的磁盘列表显示
- [ ] 修改`src/widgets/disk_list.rs`文件
  - 实现`render`方法显示所有磁盘挂载点
  - 使用表格格式显示类似`df -h`的信息
  - 每行显示：挂载点、文件系统、总容量、已用、可用、使用百分比
  - 按照挂载点字母顺序排序
- [ ] 实现颜色编码逻辑
  - 使用率超过阈值（默认90%）显示红色
  - 网络文件系统（NFS/SMB/CIFS）显示黄色
  - 正常状态显示默认颜色
- [ ] 实现Tab键导航高亮
  - 高亮当前选中的磁盘行
  - 在标题中显示导航提示（如"[1/3] Tab to switch"）
- [ ] 添加适当的错误处理
  - 无磁盘数据时显示友好消息
  - 处理数据格式错误
- **引用需求**：3.2, 3.3, 3.4, 3.5, 6.1, 6.2, 6.3, 6.4

### 5. 优化SystemSummaryWidget的显示
- [ ] **目标**：优化系统监控区域的显示效果
- [ ] 修改`src/widgets/system_summary.rs`文件
  - 优化表格布局，使用更合理的列宽
  - 添加进度条可视化（使用字符绘制）
  - 改进数据格式化（如"12.34 GB"而不是"12.345678 GB"）
  - 添加系统运行时间显示
- [ ] 实现颜色编码
  - 内存使用率过高时显示警告颜色
  - CPU使用率过高时显示警告颜色
  - 保持与现有颜色方案一致
- [ ] 添加响应式设计
  - 在小宽度下自动调整列宽
  - 在极小宽度下显示简化视图
- [ ] 测试不同终端尺寸下的显示效果
  - 正常尺寸（≥80x24）
  - 小尺寸（40x10）
  - 极小尺寸（30x6）
- **引用需求**：2.5, 4.1, 4.2, 6.1, 6.3

### 6. 集成测试和最终优化
- [ ] **目标**：进行完整集成测试并优化细节
- [ ] 运行完整的应用测试
  - 启动应用验证所有功能正常工作
  - 测试Tab键导航在所有磁盘间切换
  - 测试颜色编码正确显示
  - 测试数据刷新正常（每2秒）
- [ ] 测试边界情况
  - 单个磁盘挂载点
  - 无磁盘挂载点
  - 网络文件系统
  - 磁盘使用率超过阈值
  - 终端尺寸变化
- [ ] 优化性能
  - 检查渲染性能，确保无卡顿
  - 优化字符串分配和格式化
  - 减少不必要的计算
- [ ] 清理临时代码
  - 移除SystemWidget中不再使用的方法
  - 更新注释和文档
  - 确保代码符合项目风格
- [ ] 验证向后兼容性
  - 所有命令行参数仍然有效
  - 现有配置文件无需修改
  - 用户可见行为变化符合预期（改进而非破坏）
- **引用需求**：5.5, 6.4, 性能需求, 兼容性需求, 可维护性需求

## 实施注意事项

### 渐进式实施
每个任务都建立在前一个任务的基础上，确保每个步骤都能独立测试和验证。如果某个步骤出现问题，可以回退到上一步。

### 测试驱动
每个任务完成后都应进行测试：
1. 编译测试：确保代码能编译通过
2. 功能测试：运行应用验证功能正常
3. 视觉测试：检查UI显示效果

### 代码质量
- 保持现有代码风格一致
- 添加适当的错误处理
- 避免过度工程化
- 优先解决实际问题

### 用户反馈
在实施过程中，如果发现设计文档中未考虑的情况，应及时记录并评估是否需要调整设计。